<div class="modal fade" id="addUsersModal" tabindex="-1" aria-labelledby="addUsersModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered modal-lg">
		<div class="modal-content">
			<div class="modal-header bg-primary text-white">
				<h5 class="modal-title" id="addUsersModalLabel">
					<i class="fas fa-user-plus me-2"></i>
					Agregar Usuarios al Punto de Venta
				</h5>
				<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<div class="alert alert-info" *ngIf="puntoVenta">
					<i class="fas fa-info-circle me-2"></i>
					<strong>Punto de Venta:</strong>
					<code>{{ puntoVenta.codigo_punto_venta }}</code> - {{ puntoVenta.nombre }}
				</div>

				<!-- Mensaje de error -->
				<div class="alert alert-danger" *ngIf="submitError">
					<i class="fas fa-exclamation-triangle me-2"></i>
					{{ submitError }}
				</div>

				<form [formGroup]="form">
					<!-- Select de Usuario con Buscador -->
					<div class="mb-3">
						<label class="form-label">
							<i class="fas fa-user me-1"></i>
							Usuario <span class="text-danger">*</span>
						</label>

						<!-- Buscador -->
						<div class="input-group mb-2">
							<span class="input-group-text">
								<i class="fas fa-search"></i>
							</span>
							<input
								type="text"
								class="form-control"
								[(ngModel)]="searchTerm"
								[ngModelOptions]="{standalone: true}"
								(ngModelChange)="filterUsuarios()"
								placeholder="Buscar por nombre o apellido...">
						</div>

						<!-- Select con scroll -->
						<div *ngIf="isLoading" class="text-center py-3">
							<div class="spinner-border spinner-border-sm text-primary" role="status">
								<span class="visually-hidden">Cargando...</span>
							</div>
							<small class="text-muted ms-2">Cargando usuarios...</small>
						</div>

						<select
							class="form-select"
							formControlName="id_usuario"
							size="8"
							[class.is-invalid]="form.get('id_usuario')?.invalid && form.get('id_usuario')?.touched"
							*ngIf="!isLoading">
							<option value="" disabled>Seleccione un usuario</option>
							<option
								*ngFor="let usuario of filteredUsuarios"
								[value]="usuario.id_usuario">
								{{ getUsuarioNombreCompleto(usuario) }}
							</option>
						</select>
						<div class="invalid-feedback" *ngIf="form.get('id_usuario')?.invalid && form.get('id_usuario')?.touched">
							Debe seleccionar un usuario
						</div>
						<small class="text-muted" *ngIf="!isLoading">
							{{ filteredUsuarios.length }} usuario(s) disponible(s)
						</small>
					</div>

					<!-- Fecha y Hora de Vencimiento -->
					<div class="mb-3">
						<label class="form-label">
							<i class="fas fa-calendar-alt me-1"></i>
							Fecha y Hora de Vencimiento <span class="text-danger">*</span>
						</label>
						<input
							type="datetime-local"
							class="form-control"
							formControlName="vencimiento_asig"
							[class.is-invalid]="form.get('vencimiento_asig')?.invalid && form.get('vencimiento_asig')?.touched">
						<div class="invalid-feedback" *ngIf="form.get('vencimiento_asig')?.invalid && form.get('vencimiento_asig')?.touched">
							La fecha de vencimiento es requerida
						</div>
						<small class="text-muted">
							<i class="fas fa-info-circle me-1"></i>
							Fecha hasta la cual el usuario tendra acceso al punto de venta
						</small>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" (click)="closeModal()" [disabled]="isSaving">
					<i class="fas fa-times me-1"></i>
					Cancelar
				</button>
				<button type="button" class="btn btn-primary" (click)="onSave()" [disabled]="isSaving || form.invalid">
					<span *ngIf="!isSaving">
						<i class="fas fa-save me-1"></i>
						Asignar Usuario
					</span>
					<span *ngIf="isSaving">
						<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
						Asignando...
					</span>
				</button>
			</div>
		</div>
	</div>
</div>

<div class="container-fluid">
	<!-- Alertas -->
	<div *ngIf="alertMessage" class="alert alert-{{alertType}} alert-dismissible fade show position-fixed" 
		 style="top: 20px; right: 20px; z-index: 1050; max-width: 400px;">
		{{ alertMessage }}
		<button type="button" class="btn-close" (click)="alertMessage = ''" aria-label="Close"></button>
	</div>

	<!-- Header -->
	<div class="row mb-4">
		<div class="col-12">
			<h2 class="mb-3">Parámetros del Sistema</h2>
			
			<!-- Navegación de pestañas -->
			<ul class="nav nav-tabs" id="parametrosTabs" role="tablist">
				<li class="nav-item" role="presentation">
					<button class="nav-link" 
							[class.active]="activeTab === 'parametros-economicos'"
							(click)="setActiveTab('parametros-economicos')"
							type="button">
						<i class="fas fa-dollar-sign me-2"></i>
						Parámetros Económicos
					</button>
				</li>
				<li class="nav-item" role="presentation">
					<button class="nav-link" 
							[class.active]="activeTab === 'items-cobro'"
							(click)="setActiveTab('items-cobro')"
							type="button">
						<i class="fas fa-receipt me-2"></i>
						Items de Cobro
					</button>
				</li>
			</ul>
		</div>
	</div>

	<!-- Contenido de las pestañas -->
	<div class="tab-content" id="parametrosTabContent">
		
		<!-- Pestaña Parámetros Económicos -->
		<div class="tab-pane fade" 
			 [class.show]="activeTab === 'parametros-economicos'"
			 [class.active]="activeTab === 'parametros-economicos'">
			
			<!-- Controles superiores -->
			<div class="row mb-3">
				<div class="col-md-6">
					<div class="input-group">
						<span class="input-group-text">
							<i class="fas fa-search"></i>
						</span>
						<input type="text" 
							   class="form-control" 
							   placeholder="Buscar parámetros..." 
							   [(ngModel)]="searchTerm"
							   name="searchTerm">
					</div>
				</div>
				<div class="col-md-6 text-end">
					<button class="btn btn-primary" (click)="openParametroEconomicoModal()">
						<i class="fas fa-plus me-2"></i>
						Nuevo Parámetro
					</button>
				</div>
			</div>

			<!-- Tabla de Parámetros Económicos -->
			<div class="card">
				<div class="card-body">
					<div class="table-responsive">
						<table class="table table-striped table-hover">
							<thead class="table-dark">
								<tr>
									<th>ID</th>
									<th>Nombre</th>
									<th>Valor</th>
									<th>Descripción</th>
									<th>Estado</th>
									<th>Acciones</th>
								</tr>
							</thead>
							<tbody>
								<tr *ngFor="let parametro of getFilteredParametrosEconomicos()">
									<td>{{ parametro.id_parametro_economico }}</td>
									<td>{{ parametro.nombre }}</td>
									<td>{{ parametro.valor }}</td>
									<td>{{ parametro.descripcion }}</td>
									<td>
										<span class="badge" 
											  [class.bg-success]="parametro.estado"
											  [class.bg-danger]="!parametro.estado">
											{{ parametro.estado ? 'Activo' : 'Inactivo' }}
										</span>
									</td>
									<td>
										<div class="btn-group btn-group-sm" role="group">
											<button class="btn btn-outline-primary" 
													(click)="openParametroEconomicoModal(parametro)"
													title="Editar">
												<i class="fas fa-edit"></i>
											</button>
											<button class="btn btn-outline-warning" 
													(click)="toggleStatus(parametro, 'parametro-economico')"
													title="Cambiar Estado">
												<i class="fas fa-toggle-on" *ngIf="parametro.estado"></i>
												<i class="fas fa-toggle-off" *ngIf="!parametro.estado"></i>
											</button>
											<button class="btn btn-outline-danger" 
													(click)="confirmDelete(parametro, 'parametro-economico')"
													title="Eliminar">
												<i class="fas fa-trash"></i>
											</button>
										</div>
									</td>
								</tr>
								<tr *ngIf="getFilteredParametrosEconomicos().length === 0">
									<td colspan="6" class="text-center text-muted">
										<i class="fas fa-inbox fa-2x mb-2"></i>
										<br>
										No se encontraron parámetros económicos
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>

		<!-- Pestaña Items de Cobro -->
		<div class="tab-pane fade" 
			 [class.show]="activeTab === 'items-cobro'"
			 [class.active]="activeTab === 'items-cobro'">
			
			<!-- Controles superiores -->
			<div class="row mb-3">
				<div class="col-md-6">
					<div class="input-group">
						<span class="input-group-text">
							<i class="fas fa-search"></i>
						</span>
						<input type="text" 
							   class="form-control" 
							   placeholder="Buscar items..." 
							   [(ngModel)]="searchTerm"
							   name="searchTermItems">
					</div>
				</div>
				<div class="col-md-6 text-end">
					<button class="btn btn-primary" (click)="openItemCobroModal()">
						<i class="fas fa-plus me-2"></i>
						Nuevo Item
					</button>
				</div>
			</div>

			<!-- Tabla de Items de Cobro -->
			<div class="card">
				<div class="card-body">
					<div class="table-responsive">
						<table class="table table-striped table-hover">
							<thead class="table-dark">
								<tr>
									<th>ID</th>
									<th>Código</th>
									<th>Servicio</th>
									<th>Créditos</th>
									<th>Costo</th>
									<th>Tipo</th>
									<th>Facturado</th>
									<th>Estado</th>
									<th>Acciones</th>
								</tr>
							</thead>
							<tbody>
								<tr *ngFor="let item of getFilteredItemsCobro()">
									<td>{{ item.id_item }}</td>
									<td>{{ item.codigo_producto_interno }}</td>
									<td>{{ item.nombre_servicio }}</td>
									<td>{{ item.nro_creditos }}</td>
									<td>{{ item.costo | currency:'USD':'symbol':'1.2-2' }}</td>
									<td>{{ item.tipo_item }}</td>
									<td>
										<span class="badge" 
											  [class.bg-success]="item.facturado"
											  [class.bg-secondary]="!item.facturado">
											{{ item.facturado ? 'Sí' : 'No' }}
										</span>
									</td>
									<td>
										<span class="badge" 
											  [class.bg-success]="item.estado"
											  [class.bg-danger]="!item.estado">
											{{ item.estado ? 'Activo' : 'Inactivo' }}
										</span>
									</td>
									<td>
										<div class="btn-group btn-group-sm" role="group">
											<button class="btn btn-outline-primary" 
													(click)="openItemCobroModal(item)"
													title="Editar">
												<i class="fas fa-edit"></i>
											</button>
											<button class="btn btn-outline-warning" 
													(click)="toggleStatus(item, 'item-cobro')"
													title="Cambiar Estado">
												<i class="fas fa-toggle-on" *ngIf="item.estado"></i>
												<i class="fas fa-toggle-off" *ngIf="!item.estado"></i>
											</button>
											<button class="btn btn-outline-danger" 
													(click)="confirmDelete(item, 'item-cobro')"
													title="Eliminar">
												<i class="fas fa-trash"></i>
											</button>
										</div>
									</td>
								</tr>
								<tr *ngIf="getFilteredItemsCobro().length === 0">
									<td colspan="9" class="text-center text-muted">
										<i class="fas fa-inbox fa-2x mb-2"></i>
										<br>
										No se encontraron items de cobro
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal para Parámetros Económicos -->
	<div class="modal fade" [class.show]="showModal && activeTab === 'parametros-economicos'" 
		 [style.display]="showModal && activeTab === 'parametros-economicos' ? 'block' : 'none'"
		 tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">
						{{ editingItem ? 'Editar' : 'Nuevo' }} Parámetro Económico
					</h5>
					<button type="button" class="btn-close" (click)="closeModal()"></button>
				</div>
				<form [formGroup]="parametroEconomicoForm" (ngSubmit)="saveParametroEconomico()">
					<div class="modal-body">
						<div class="mb-3">
							<label class="form-label">Nombre *</label>
							<input type="text" 
								   class="form-control" 
								   formControlName="nombre"
								   maxlength="20">
							<div class="form-text">Máximo 20 caracteres</div>
						</div>
						<div class="mb-3">
							<label class="form-label">Valor *</label>
							<input type="text" 
								   class="form-control" 
								   formControlName="valor">
						</div>
						<div class="mb-3">
							<label class="form-label">Descripción *</label>
							<textarea class="form-control" 
									  formControlName="descripcion" 
									  rows="3"></textarea>
						</div>
						<div class="form-check">
							<input class="form-check-input" 
								   type="checkbox" 
								   formControlName="estado">
							<label class="form-check-label">
								Activo
							</label>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" (click)="closeModal()">
							Cancelar
						</button>
						<button type="submit" 
								class="btn btn-primary" 
								[disabled]="!parametroEconomicoForm.valid">
							{{ editingItem ? 'Actualizar' : 'Crear' }}
						</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<!-- Modal para Items de Cobro -->
	<div class="modal fade" [class.show]="showModal && activeTab === 'items-cobro'" 
		 [style.display]="showModal && activeTab === 'items-cobro' ? 'block' : 'none'"
		 tabindex="-1">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">
						{{ editingItem ? 'Editar' : 'Nuevo' }} Item de Cobro
					</h5>
					<button type="button" class="btn-close" (click)="closeModal()"></button>
				</div>
				<form [formGroup]="itemCobroForm" (ngSubmit)="saveItemCobro()">
					<div class="modal-body">
						<div class="row">
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Código Interno *</label>
									<input type="text" 
										   class="form-control" 
										   formControlName="codigo_producto_interno"
										   maxlength="15">
								</div>
							</div>
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Código Impuesto</label>
									<input type="number" 
										   class="form-control" 
										   formControlName="codigo_producto_impuesto">
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-md-8">
								<div class="mb-3">
									<label class="form-label">Nombre del Servicio *</label>
									<input type="text" 
										   class="form-control" 
										   formControlName="nombre_servicio"
										   maxlength="100">
								</div>
							</div>
							<div class="col-md-4">
								<div class="mb-3">
									<label class="form-label">Unidad de Medida *</label>
									<input type="number" 
										   class="form-control" 
										   formControlName="unidad_medida">
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-md-4">
								<div class="mb-3">
									<label class="form-label">Créditos *</label>
									<input type="number" 
										   class="form-control" 
										   formControlName="nro_creditos"
										   min="0">
								</div>
							</div>
							<div class="col-md-4">
								<div class="mb-3">
									<label class="form-label">Costo</label>
									<input type="number" 
										   class="form-control" 
										   formControlName="costo"
										   step="0.01"
										   min="0">
								</div>
							</div>
							<div class="col-md-4">
								<div class="mb-3">
									<label class="form-label">Parámetro Económico *</label>
									<select class="form-select" formControlName="id_parametro_economico">
										<option value="">Seleccionar...</option>
										<option *ngFor="let param of parametrosEconomicos" 
												[value]="param.id_parametro_economico">
											{{ param.nombre }}
										</option>
									</select>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Actividad Económica *</label>
									<input type="text" 
										   class="form-control" 
										   formControlName="actividad_economica">
								</div>
							</div>
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Tipo de Item *</label>
									<input type="text" 
										   class="form-control" 
										   formControlName="tipo_item"
										   maxlength="40">
								</div>
							</div>
						</div>
						<div class="mb-3">
							<label class="form-label">Descripción</label>
							<textarea class="form-control" 
									  formControlName="descripcion" 
									  rows="2"></textarea>
						</div>
						<div class="row">
							<div class="col-md-6">
								<div class="form-check">
									<input class="form-check-input" 
										   type="checkbox" 
										   formControlName="facturado">
									<label class="form-check-label">
										Facturado
									</label>
								</div>
							</div>
							<div class="col-md-6">
								<div class="form-check">
									<input class="form-check-input" 
										   type="checkbox" 
										   formControlName="estado">
									<label class="form-check-label">
										Activo
									</label>
								</div>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" (click)="closeModal()">
							Cancelar
						</button>
						<button type="submit" 
								class="btn btn-primary" 
								[disabled]="!itemCobroForm.valid">
							{{ editingItem ? 'Actualizar' : 'Crear' }}
						</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<!-- Modal de Confirmación de Eliminación -->
	<div class="modal fade" [class.show]="showDeleteModal" 
		 [style.display]="showDeleteModal ? 'block' : 'none'"
		 tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Confirmar Eliminación</h5>
					<button type="button" class="btn-close" (click)="closeDeleteModal()"></button>
				</div>
				<div class="modal-body">
					<p>¿Está seguro que desea eliminar este elemento?</p>
					<p class="text-danger">
						<strong>Esta acción no se puede deshacer.</strong>
					</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" (click)="closeDeleteModal()">
						Cancelar
					</button>
					<button type="button" class="btn btn-danger" (click)="deleteItem()">
						Eliminar
					</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Loading Spinner -->
	<div *ngIf="loading" class="d-flex justify-content-center align-items-center position-fixed" 
		 style="top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999;">
		<div class="spinner-border text-primary" role="status">
			<span class="visually-hidden">Cargando...</span>
		</div>
	</div>
</div>

<ng-container *ngIf="isSelected">
	<div class="d-flex align-items-center gap-2 mt-2">
		<span class="me-2">Estado QR</span>
		<span class="badge" [ngClass]="statusClass">{{ statusLabel }}</span>
		<button type="button" class="btn btn-success btn-sm ms-3" (click)="onClickGenerar()" [disabled]="loading || status==='completado' || (totalCobro <= 0 && !alias)">
			{{ (alias && !isFinalStatus) ? 'Mostrar QR' : 'Generar QR' }}
		</button>
		<button type="button" class="btn btn-outline-secondary btn-sm" (click)="onClickConsultar()" [disabled]="loading || !alias">Consultar</button>
	</div>

	<div class="modal fade" id="qrPanelModal" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Pago QR</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<div class="mb-2 d-flex align-items-center gap-2">
						<span>Estado:</span>
						<span class="badge" [ngClass]="statusClass">{{ statusLabel }}</span>
					</div>
					<div class="mb-2 d-flex justify-content-between">
						<span>Monto:</span>
						<strong>{{ amount | number:'1.2-2' }}</strong>
					</div>
					<div class="mb-3 d-flex justify-content-between">
						<span>Expira:</span>
						<strong>{{ expiresAt || '-' }}</strong>
					</div>
					<div class="text-center" *ngIf="imageBase64; else noqr">
						<img [src]="'data:image/png;base64,' + imageBase64" alt="QR" class="img-fluid qr-img" [class.qr-zoom]="zoomed" />
					</div>
					<div class="d-flex justify-content-center gap-2 mt-2" *ngIf="imageBase64">
						<button type="button" class="btn btn-sm btn-outline-primary" (click)="onToggleZoom()">{{ zoomed ? 'Tamaño normal' : 'Ampliar QR' }}</button>
						<button type="button" class="btn btn-sm btn-outline-secondary" (click)="onDescargar()">Descargar QR</button>
					</div>
					<div class="mt-3 small" *ngIf="imageBase64">
						<div class="text-center fw-semibold">El documento será emitido con los siguientes datos</div>
						<div class="row mt-1">
							<div class="col-8">
								<div><span class="fw-semibold">{{ docLabel }}:</span> {{ docNumero || '-' }}</div>
								<div><span class="fw-semibold">R. Social:</span> {{ razonSocial || '-' }}</div>
								<div><span class="fw-semibold">Monto:</span> BOB {{ amount | number:'1.2-2' }}</div>
							</div>
							<div class="col-4 text-end">
								<div><span class="fw-semibold">Pago Único:</span> Si</div>
							</div>
						</div>
					</div>
					<ng-template #noqr>
						<div class="text-muted small text-center">QR no generado</div>
					</ng-template>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-danger" (click)="onClickAnular()" [disabled]="loading || !alias">Anular QR</button>
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Fallback ligero cuando no hay Bootstrap Modal disponible -->
	<div *ngIf="localOpen" class="border rounded p-3 mt-3">
		<div class="d-flex justify-content-between align-items-center mb-2">
			<h5 class="m-0">Pago QR</h5>
			<button type="button" class="btn btn-sm btn-outline-secondary" (click)="cerrar()">Cerrar</button>
		</div>
		<div class="mb-2 d-flex align-items-center gap-2">
			<span>Estado:</span>
			<span class="badge" [ngClass]="statusClass">{{ statusLabel }}</span>
		</div>
		<div class="mb-2 d-flex justify-content-between">
			<span>Monto:</span>
			<strong>{{ amount | number:'1.2-2' }}</strong>
		</div>
		<div class="mb-3 d-flex justify-content-between">
			<span>Expira:</span>
			<strong>{{ expiresAt || '-' }}</strong>
		</div>
		<div class="text-center" *ngIf="imageBase64; else noqr_local">
			<img [src]="'data:image/png;base64,' + imageBase64" alt="QR" class="img-fluid qr-img" [class.qr-zoom]="zoomed" />
		</div>
		<div class="d-flex justify-content-center gap-2 mt-2" *ngIf="imageBase64">
			<button type="button" class="btn btn-sm btn-outline-primary" (click)="onToggleZoom()">{{ zoomed ? 'Tamaño normal' : 'Ampliar QR' }}</button>
			<button type="button" class="btn btn-sm btn-outline-secondary" (click)="onDescargar()">Descargar QR</button>
		</div>
		<div class="mt-3 small" *ngIf="imageBase64">
			<div class="text-center fw-semibold">El documento será emitido con los siguientes datos</div>
			<div class="row mt-1">
				<div class="col-8">
					<div><span class="fw-semibold">{{ docLabel }}:</span> {{ docNumero || '-' }}</div>
					<div><span class="fw-semibold">R. Social:</span> {{ razonSocial || '-' }}</div>
					<div><span class="fw-semibold">Monto:</span> BOB {{ amount | number:'1.2-2' }}</div>
				</div>
				<div class="col-4 text-end">
					<div><span class="fw-semibold">Pago Único:</span> Si</div>
				</div>
			</div>
		</div>
		<ng-template #noqr_local>
			<div class="text-muted small text-center">QR no generado</div>
		</ng-template>
		<div class="d-flex justify-content-end gap-2 mt-3">
			<button type="button" class="btn btn-danger btn-sm" (click)="anular()" [disabled]="loading || !alias">Anular QR</button>
			<button type="button" class="btn btn-secondary btn-sm" (click)="cerrar()">Cerrar</button>
		</div>
	</div>
</ng-container>

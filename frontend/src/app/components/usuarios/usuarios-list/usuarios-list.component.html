<div class="usuarios-container">
  <div class="usuarios-header">
    <h1 class="usuarios-title">Gestión de Usuarios</h1>
    <div class="usuarios-actions">
      <div class="search-container">
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (input)="onSearch()"
          placeholder="Buscar usuario..."
          class="search-input"
        />
        <button class="search-button" (click)="onSearch()" title="Buscar">
          <i class="fas fa-search"></i>
        </button>
      </div>
      <button class="btn-primary" (click)="openCreateModal()">
        <i class="fas fa-plus"></i> Nuevo Usuario
      </button>
    </div>
  </div>

  <!-- Tabla de Usuarios -->
  <div class="table-responsive">
    <table class="usuarios-table">
      <thead>
        <tr>
          <th>Nro</th>
          <th>Usuario</th>
          <th>Nombre Completo</th>
          <th>CI</th>
          <th>Rol</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let usuario of paginatedUsuarios">
          <td>{{ usuario.id_usuario }}</td>
          <td>{{ usuario.nickname }}</td>
          <td>{{ usuario.nombre }} {{ usuario.ap_paterno }} {{ usuario.ap_materno }}</td>
          <td>{{ usuario.ci }}</td>
          <td>{{ usuario.rol?.nombre || 'Sin rol' }}</td>
          <td>
            <span class="badge" [ngClass]="usuario.estado ? 'badge-active' : 'badge-inactive'">
              {{ usuario.estado ? 'Activo' : 'Inactivo' }}
            </span>
          </td>
          <td class="actions-column">
            <button
              class="btn-icon btn-edit"
              (click)="openEditModal(usuario)"
              title="Editar"
            >
              <i class="fas fa-edit"></i>
            </button>
            <button
              class="btn-icon btn-toggle"
              (click)="toggleUsuarioStatus(usuario)"
              title="Cambiar estado"
            >
              <i class="fas" [ngClass]="usuario.estado ? 'fa-toggle-on' : 'fa-toggle-off'"></i>
            </button>
            <button
              class="btn-icon btn-delete"
              (click)="confirmDelete(usuario)"
              title="Eliminar"
            >
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
        <tr *ngIf="!isLoading && paginatedUsuarios.length === 0">
          <td colspan="7" class="no-data">No se encontraron usuarios</td>
        </tr>
        <tr *ngIf="isLoading">
          <td colspan="7" class="no-data">Cargando usuarios...</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Paginación -->
  <div class="pagination" *ngIf="filteredUsuarios.length > 0">
    <button
      class="pagination-button"
      [disabled]="currentPage === 1"
      (click)="goToPage(currentPage - 1)"
    >
      <i class="fas fa-chevron-left"></i>
    </button>
    <span class="pagination-info">
      Página {{ currentPage }} de {{ totalPages }}
    </span>
    <button
      class="pagination-button"
      [disabled]="currentPage === totalPages"
      (click)="goToPage(currentPage + 1)"
    >
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>

  <!-- Modal de Confirmación para Eliminar -->
  <div class="modal" *ngIf="showDeleteModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Confirmar Eliminación</h2>
        <button class="modal-close" (click)="cancelDelete()">×</button>
      </div>
      <div class="modal-body">
        <p>
          ¿Está seguro que desea eliminar el usuario
          "{{ usuarioToDelete?.nickname }}"?
        </p>
        <p class="modal-warning">Esta acción no se puede deshacer.</p>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="cancelDelete()">Cancelar</button>
        <button class="btn-danger" (click)="deleteUsuario()">Eliminar</button>
      </div>
    </div>
  </div>

  <!-- Modal de Creación de Usuario -->
  <div class="modal" *ngIf="showCreateModal">
    <div class="modal-content modal-lg">
      <div class="modal-header">
        <h2 class="modal-title">Nuevo Usuario</h2>
        <button class="modal-close" (click)="closeCreateModal()">×</button>
      </div>
      <div class="modal-body">
        <app-usuario-form
          [modalMode]="true"
          (closed)="onCreateClosed($event)"
        ></app-usuario-form>
      </div>
    </div>
  </div>

  <!-- Modal de Edición de Usuario -->
  <div class="modal" *ngIf="showEditModal">
    <div class="modal-content modal-lg">
      <div class="modal-header">
        <h2 class="modal-title">Editar Usuario</h2>
        <button class="modal-close" (click)="closeEditModal()">×</button>
      </div>
      <div class="modal-body">
        <app-usuario-form
          [modalMode]="true"
          [usuarioIdInput]="editUsuarioId"
          (closed)="onEditClosed($event)"
        ></app-usuario-form>
      </div>
    </div>
  </div>
</div>

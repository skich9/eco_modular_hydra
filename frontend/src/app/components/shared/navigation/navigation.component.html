<!-- Navigation Header -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
	<div class="container-fluid px-4">
		<a routerLink="/dashboard" class="navbar-brand d-flex align-items-center">
			<div class="nav-logo-icon me-3">
				<img src="assets/images/logo-ceta.png" alt="Logo CETA" class="img-fluid" style="height: 40px;">
			</div>
			<div class="nav-logo-text">
				<span class="nav-logo-title fw-bold fs-5 text-dark">Sistema de Cobros</span>
				<p class="nav-logo-subtitle mb-0 text-muted small">Instituto Tecnológico CETA</p>
			</div>
		</a>

		<div class="d-flex align-items-center" *ngIf="currentUser">
			<div class="me-3 d-none d-md-block">
				<span class="fw-semibold text-dark">{{ currentUser.nombre_completo }}</span>
				<span class="text-muted ms-1">({{ currentUser.rol?.nombre }})</span>
			</div>
			
			<div class="dropdown">
				<button 
					type="button" 
					class="btn btn-link p-0 border-0"
					data-user-dropdown
					(click)="toggleDropdown()"
					[attr.aria-expanded]="showUserDropdown"
				>
					<div class="nav-user-avatar d-flex align-items-center justify-content-center rounded-circle bg-primary text-white fw-semibold" 
						 style="width: 40px; height: 40px;">
						{{ getUserInitial() }}
					</div>
				</button>
				
				<div 
					class="dropdown-menu dropdown-menu-end"
					[class.show]="showUserDropdown"
				>
					<a href="#" class="dropdown-item py-2" (click)="changePassword($event)">
						<i class="fas fa-key me-2 text-primary"></i>Cambiar Contraseña
					</a>
					<div class="dropdown-divider"></div>
					<a href="#" class="dropdown-item py-2 text-danger" (click)="logout($event)">
						<i class="fas fa-sign-out-alt me-2"></i>Cerrar Sesión
					</a>
				</div>
			</div>
		</div>
	</div>
</nav>

<!-- Secondary Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
	<div class="container-fluid px-4">
		<div class="navbar-nav d-flex flex-row">
			<div 
				*ngFor="let item of menuItems; let i = index" 
				class="nav-item dropdown me-3"
			>
				<button 
					type="button" 
					class="btn btn-link nav-link dropdown-toggle text-white border-0 d-flex align-items-center"
					(click)="toggleConfigMenu(i)"
					[attr.aria-expanded]="activeSubmenu === i"
				>
					<i class="{{ item.icon }} me-2"></i>
					{{ item.name }}
				</button>
				
				<div 
					class="dropdown-menu"
					[class.show]="activeSubmenu === i"
				>
					<a 
						*ngFor="let subitem of item.submenu"
						[routerLink]="subitem.route"
						class="dropdown-item py-2"
						[class.active]="isActiveRoute(subitem.route)"
						(click)="closeAllMenus()"
					>
						<i class="fas {{ subitem.icon }} me-2"></i>{{ subitem.name }}
					</a>
				</div>
			</div>
		</div>
	</div>
</nav>

<!-- Modal de Cambiar Contraseña -->
<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="changePasswordModalLabel">Cambiar Contraseña</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<form [formGroup]="changePasswordForm" (ngSubmit)="onChangePassword()">
					<div class="mb-3">
						<label for="contraseniaActual" class="form-label">Contraseña Actual</label>
						<input 
							type="password" 
							class="form-control" 
							id="contraseniaActual"
							formControlName="contraseniaActual"
							[class.is-invalid]="changePasswordForm.get('contraseniaActual')?.invalid && changePasswordForm.get('contraseniaActual')?.touched"
						>
						<div *ngIf="changePasswordForm.get('contraseniaActual')?.invalid && changePasswordForm.get('contraseniaActual')?.touched" class="invalid-feedback">
							La contraseña actual es requerida
						</div>
					</div>
					
					<div class="mb-3">
						<label for="contraseniaNueva" class="form-label">Nueva Contraseña</label>
						<input 
							type="password" 
							class="form-control" 
							id="contraseniaNueva"
							formControlName="contraseniaNueva"
							[class.is-invalid]="changePasswordForm.get('contraseniaNueva')?.invalid && changePasswordForm.get('contraseniaNueva')?.touched"
						>
						<div *ngIf="changePasswordForm.get('contraseniaNueva')?.invalid && changePasswordForm.get('contraseniaNueva')?.touched" class="invalid-feedback">
							La nueva contraseña debe tener al menos 6 caracteres
						</div>
					</div>
					
					<div class="mb-3">
						<label for="contraseniaNuevaConfirm" class="form-label">Confirmar Nueva Contraseña</label>
						<input 
							type="password" 
							class="form-control" 
							id="contraseniaNuevaConfirm"
							formControlName="contraseniaNuevaConfirm"
							[class.is-invalid]="changePasswordForm.get('contraseniaNuevaConfirm')?.invalid && changePasswordForm.get('contraseniaNuevaConfirm')?.touched"
						>
						<div *ngIf="changePasswordForm.get('contraseniaNuevaConfirm')?.invalid && changePasswordForm.get('contraseniaNuevaConfirm')?.touched" class="invalid-feedback">
							Las contraseñas no coinciden
						</div>
					</div>
					
					<div *ngIf="changePasswordError" class="alert alert-danger">
						{{ changePasswordError }}
					</div>
					
					<div *ngIf="changePasswordSuccess" class="alert alert-success">
						{{ changePasswordSuccess }}
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
				<button 
					type="button" 
					class="btn btn-primary" 
					[disabled]="changePasswordForm.invalid || isChangingPassword"
					(click)="onChangePassword()"
				>
					<span class="spinner-border spinner-border-sm me-2" *ngIf="isChangingPassword"></span>
					{{ isChangingPassword ? 'Cambiando...' : 'Cambiar Contraseña' }}
				</button>
			</div>
		</div>
	</div>
</div>
